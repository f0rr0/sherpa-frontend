<!DOCTYPE html>
<html>
<head>
    <title>SHERPA - TURNS INSTAGRAM INTO A TRAVEL GUIDE</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta property="og:title" content="Sherpa" />
    <meta property="og:url" content="http://www.trysherpa.com" />
    <meta property="og:image" content="http://www.trysherpa.com/share.jpg" />
    <meta property="og:description" content="Sherpa turns instagram into a travel guide" />

    <link href="stylesheets/global.css" rel="stylesheet">
    <link href="libs/share-button.css" rel="stylesheet">
    <script src="libs/share-button.js"></script>
    <script src="libs/ig.js"></script>
    <script src="https://use.typekit.net/iei4azk.js"></script>
    <script src="libs/jquery-2.2.0.min.js"></script>
    <script src="libs/TweenMax.min.js"></script>
    <script src="libs/ScrollToPlugin.min.js"></script>
    <script src="libs/jquery.iosslider.js"></script>
    <script src="libs/history.min.js"></script>
    <script src="libs/polyfiller.js"></script>
    <script src="https://rawgit.com/flatiron/director/master/build/director.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.2.8/jquery.form-validator.min.js"></script>
    <script src="http://jqueryvalidation.org/files/dist/jquery.validate.min.js"></script>

    <script>try{Typekit.load({ async: true });}catch(e){}</script>
    <script type="text/javascript">
        $(document).ready(function(){

            $.validate();

            document.ontouchmove = function(event){
                event.preventDefault();
            };


            var routes = {
                '/':landingPage,
                '/post-signup': {
                    '/:token/:email/:serviceObject': {
                        //
                        // this function will return the value 'yella'.
                        //
                        on: function (token,email,serviceObject) {
                           var serviceData=JSON.parse(decodeURIComponent(serviceObject));
                            var url="http://api.trysherpa.com/api/v1/login";
                            var queryData = encodeQueryData({
                                email:decodeURIComponent(email),
                                inviteCode:"web-invite",
                                service:"instagram",
                                token:token,
                                serviceData:JSON.stringify(serviceData.user),
                                deviceData:JSON.stringify({browser:"unknown"})
                            });

                            console.log("sign up with sherpa",{
                                email:decodeURIComponent(email),
                                inviteCode:"web-invite",
                                service:"instagram",
                                token:token,
                                serviceData:JSON.stringify(serviceData.user),
                                deviceData:JSON.stringify({browser:"unknown"})
                            });


                            $.ajax({type: "POST",
                                    url: url,
                                    data: queryData,
                                    success: function(res) {
                                        console.log("success signup",res);
                                    },
                                    error:function(req,err){
                                        console.log('error signup')
                                        console.log(req,err)
                                    }
                            });

                            signupComplete();
                        }
                    }
                }
            };

            function encodeQueryData(data) {
                var ret = [];
                for (var d in data)
                    ret.push(encodeURIComponent(d) + "=" + encodeURIComponent(data[d]));
                return ret.join("&");
            }

            var router = Router(routes);

            $(".sherpa-signup").submit(function(e){
                e.preventDefault();
                $(".sherpa-signup").validate();
                if($(".sherpa-signup").valid()){

                    ga('send', {
                        hitType: 'event',
                        eventCategory: 'Signup',
                        eventAction: 'start',
                        eventLabel: 'Sherpa Signup Start'
                    });

                    window.location.href="https://www.instagram.com/oauth/authorize/?response_type=code&client_id=6c93234fa3544a6592b382a0a814e555&redirect_uri=http://trysherpa.com/callback/?email="+encodeURIComponent($(".email-input").val());
                }else{
                    TweenMax.to(".connect-btn",.5,{backgroundColor:"#FF0000"})
                }
            });
            function signupComplete(){

                ga('send', {
                    hitType: 'event',
                    eventCategory: 'Signup',
                    eventAction: 'complete',
                    eventLabel: 'Sherpa Signup Complete'
                });


                applyOpen=false;
                toggleApply();
                TweenMax.to(".step-1",.1,{autoAlpha:0});
                TweenMax.to(".step-2",.1,{autoAlpha:1});
            }

            function landingPage(){
                applyOpen=true;
                toggleApply();
            }

            router.init();

            $("body").scrollTop(0);

            TweenMax.to("body,html",1,{autoAlpha:1,ease:Expo.easeOut})
            $('.iosslider').iosSlider({
                snapToChildren: true,
                desktopClickDrag: true,
                autoSlide:true,
                autoSlideTimer:2400,
                autoSlideTransTimer:1500,
                infiniteSlider: true,
            });

            var applyOpen=false;
            $(".btn.apply").on("click",function(e){
                e.preventDefault();
                toggleApply();
            });

            $(".close-signup").on("click",function(e){
                e.preventDefault();
                toggleApply();
            });


            function toggleApply(){
                if(!applyOpen){
                    TweenMax.to(".page-landing",.5,{top:$(window).width()<767?"-80vh":"-32vh",ease:Expo.easeOut});
                    TweenMax.to(".page-signup",.5,{bottom:"0",ease:Expo.easeOut});
                }else{
                    TweenMax.to(".page-landing",.5,{top:"0",ease:Expo.easeOut});
                    TweenMax.to(".page-signup",.5,{bottom:$(window).width()<767?"-80vh":"-40vh",ease:Expo.easeOut});
                }

                applyOpen=!applyOpen;
            }

            var shareButton = new 	ShareButton({
                url: "http://www.trysherpa.com",
                caption: "Worlds greatest travel guide",
                title: "Sherpa",
                image: "http://www.trysherpa.com/share.jpg",
                description: "Sherpa turns Instagram into a travel guide",
                ui: {
                    collision: true
                }
            });
            shareButton.open();
            var isOpen=false;

            var eType=$(window).width()>767?"click":"touchstart";
            $(".start-slide").on(eType,function(e){
                e.preventDefault();
                if(!isOpen){
                    $(".sherpa-video")[0].play();
                    if($(window).width()>767){
                        TweenMax.to(".slider",.5,{right:"50%",ease:Expo.easeOut},0)
                        TweenMax.to(".start-slide",.5,{x:"150%",ease:Expo.easeOut},0)
                        TweenMax.to(".start-slide",.1,{background:"rgba(255,255,255,0)",ease:Quad.easeOut},0)
                        TweenMax.to(".page-landing .description",.5,{x:"8%",y:"-50%",autoAlpha:0,ease:Expo.easeOut},0)
                        TweenMax.to(".play-icon",.5,{marginTop:"-100%",autoAlpha:0,ease:Expo.easeOut},0)
                    }
                }else{
                    $(".sherpa-video")[0].currentTime=0;
                    $(".sherpa-video")[0].pause();

                    if($(window).width()>767) {
                        TweenMax.to(".slider", .5, {right: "30%", ease: Expo.easeOut}, 0)
                        TweenMax.to(".start-slide", .5, {x: "0%", ease: Expo.easeOut}, 0)
                        TweenMax.to(".start-slide", .5, {
                            background: "rgba(255,255,255,.5)",
                            delay: .3,
                            ease: Quad.easeOut
                        }, 0)
                        TweenMax.to(".page-landing .description", .5, {
                            x: "0%",
                            y: "-50%",
                            autoAlpha: 1,
                            ease: Expo.easeOut
                        }, 0)
                        TweenMax.to(".play-icon", .5, {marginTop: "0%", autoAlpha: 1, ease: Expo.easeOut}, 0)
                    }
                }

                isOpen=!isOpen;
            })
        })
    </script>

</head>
<body>

<div id="container"></div>

<div class="page page-landing">
    <div class="description">
        <div class="header">
            <img src="images/logo.png">
        </div>
        <div class="sub-copy">
            <p>SHERPA TURNS INSTAGRAM INTO A TRAVEL GUIDE.</p>
            <a class="btn apply" href="#"><span class="icon"><img src="images/icon-suitcase.png" alt=""></span><span class="btn-copy">Apply for the Beta</span></a>
        </div>
    </div>
    <div class="slider">
        <div class="slider-container">
            <video src="retina.mp4" class="sherpa-video"></video>
            <!--<div class="iosslider">-->
                <!--<div class="slides">-->
                    <!--<div class="slide">-->
                        <!--<img src="images/intro-slider/3.jpg" alt="">-->
                    <!--</div>-->
                    <!--<div class="slide">-->
                        <!--<img src="images/intro-slider/4.jpg" alt="">-->
                    <!--</div>-->
                    <!--<div class="slide">-->
                        <!--<img src="images/intro-slider/5.jpg" alt="">-->
                    <!--</div>-->
                    <!--<div class="slide">-->
                        <!--<img src="images/intro-slider/6.jpg" alt="">-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
            <a href="#" class="start-slide">
                <div class="icons">
                    <span class="play-icon">
                        <img src="images/play.png" alt="">
                    </span>
                    <span class="close-icon">
                        <img src="images/close.png" alt="">
                    </span>
                </div>
            </a>
            <img src="images/iphone.png" class="slider-phone" alt="">
        </div>
    </div>
    <div class="terms">
        <a href="tos.pdf" target="_blank" class="tos">Terms Of Service</a>
        <a href="privacy.pdf" target="_blank" class="privacy">Privacy Policy</a>
    </div>
</div>


<div class="page-signup">
    <div class="close-signup">

    </div>

    <div class="step-2">
        <div class="sub-copy">
            <p>Thanks, we are reviewing your Instagram travel pics
                and will let you know when we are ready for you. <br/><br/>
                If you can, please share with your world traveling
                friends.</p>
        </div>
        <share-button></share-button>
    </div>

    <div class="step-1">
        <div class="sub-copy">
            <p>We are looking for experienced travelers to join our beta program. Enter your email address and connect your Instagram account to apply.</p>
        </div>
        <div class="signup-form">
            <form action="" class="sherpa-signup">
                <input class="email email-input" data-validation="email"  type="email" required placeholder="Enter your email"/>
                 <button type="submit" class="btn connect-btn">
                    <span class="icon icon-instagram"><img src="images/instagram.png" alt=""></span>
                    <span class="btn-copy">Connect to Instagram</span>
                 </button>
            </form>
        </div>
    </div>

</div>

{% block javascript %}
<script src="javascripts/app.js"></script>
{% endblock %}
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-75939846-1', 'auto');
    ga('send', 'pageview');

</script>

</body>
</html>
